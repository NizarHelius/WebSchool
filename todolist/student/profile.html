<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Mon Profil - E6SCHOOL</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <!-- Custom Style (similar to other student pages) -->
    <style>
      :root {
        --primary-color: #755757;
        --secondary-color: #481010;
        --accent-color: #987880;
        --light-bg: #f8f9fa;
        --dark-text: #391c23;
        --success-color: #c08ea0;
        --warning-color: #a53333;
      }

      body {
        background-color: var(--light-bg);
        font-family: "Poppins", sans-serif;
        color: var(--dark-text);
      }

      .navbar {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      .navbar-brand {
        font-weight: 600;
        letter-spacing: 0.5px;
        font-size: 1.2rem;
      }

      .container {
        max-width: 800px;
        animation: fadeIn 0.8s ease-out;
      }

      h1 {
        color: var(--secondary-color);
        font-weight: 600;
        position: relative;
        padding-bottom: 1rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      h1::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 4px;
        background: var(--accent-color);
        border-radius: 2px;
      }

      .card {
        border: none;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        margin-bottom: 2rem;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
      }

      .card-header {
        background-color: white;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        padding: 1.25rem 1.5rem;
      }

      .card-header h5 {
        font-weight: 600;
        color: var(--secondary-color);
        margin: 0;
      }

      .form-control {
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 0.75rem 1rem;
        transition: all 0.3s ease;
      }

      .form-control:focus {
        border-color: var(--accent-color);
        box-shadow: 0 0 0 0.25rem rgba(79, 195, 220, 0.25);
      }

      textarea.form-control {
        min-height: 150px;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        border: none;
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        letter-spacing: 0.5px;
        border-radius: 8px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .profile-img-container {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        overflow: hidden;
        background-color: #eee;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        border: 3px solid var(--accent-color);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .profile-img-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .file-input-label {
        display: block;
        background-color: var(--primary-color);
        color: white;
        padding: 8px 15px;
        border-radius: 8px;
        cursor: pointer;
        text-align: center;
        transition: background-color 0.3s ease;
      }

      .file-input-label:hover {
        background-color: var(--secondary-color);
      }

      .file-input {
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark shadow-sm">
      <div class="container-fluid d-flex align-items-center">
        <!-- Back Arrow (hidden on dashboard) -->
        <button
          id="backArrow"
          class="btn btn-link text-white me-2"
          style="font-size: 1.5rem"
          aria-label="Retour"
        >
          <i class="fas fa-arrow-left"></i>
        </button>
        <a class="navbar-brand" href="#">
          <i class="fas fa-graduation-cap me-2"></i>Portail Étudiant
        </a>
      </div>
    </nav>

    <!-- Contenu principal -->
    <div class="container my-5">
      <h1 class="mb-4 text-center">
        <i class="fas fa-user-circle me-2"></i>Mon Profil
      </h1>

      <!-- Section: Informations Personnelles -->
      <div class="card shadow-sm mb-4">
        <div class="card-header">
          <h5>
            <i class="fas fa-info-circle me-2"></i>Informations Personnelles
          </h5>
        </div>
        <div class="card-body">
          <form id="personalInfoForm">
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="firstName" class="form-label">Prénom</label>
                <input
                  type="text"
                  class="form-control"
                  id="firstName"
                  name="firstName"
                />
              </div>
              <div class="col-md-6">
                <label for="lastName" class="form-label">Nom</label>
                <input
                  type="text"
                  class="form-control"
                  id="lastName"
                  name="lastName"
                />
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="email" class="form-label">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  name="email"
                  disabled
                />
              </div>
              <div class="col-md-6">
                <label for="phone" class="form-label">Téléphone</label>
                <input
                  type="tel"
                  class="form-control"
                  id="phone"
                  name="phone"
                />
              </div>
            </div>
            <div class="mb-3">
              <label for="address" class="form-label">Adresse</label>
              <textarea
                class="form-control"
                id="address"
                name="address"
                rows="3"
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save me-2"></i>Enregistrer les modifications
            </button>
          </form>
        </div>
      </div>

      <!-- Section: Photo de Profil -->
      <div class="card shadow-sm mb-4">
        <div class="card-header">
          <h5><i class="fas fa-camera me-2"></i>Photo de Profil</h5>
        </div>
        <div class="card-body text-center">
          <div class="profile-img-container">
            <img
              id="profileImagePreview"
              src="https://via.placeholder.com/120/E0E0E0/808080?text=Profil"
              alt="Photo de profil"
            />
          </div>
          <form id="profilePictureForm" enctype="multipart/form-data">
            <input
              type="file"
              id="profilePictureInput"
              name="profilePicture"
              class="file-input"
              accept="image/*"
            />
            <label for="profilePictureInput" class="file-input-label">
              <i class="fas fa-upload me-2"></i>Télécharger une nouvelle photo
            </label>
            <button type="submit" class="btn btn-primary mt-3">
              <i class="fas fa-sync-alt me-2"></i>Mettre à jour la photo
            </button>
          </form>
        </div>
      </div>

      <!-- Section: Changer le Mot de Passe -->
      <div class="card shadow-sm mb-4">
        <div class="card-header">
          <h5><i class="fas fa-key me-2"></i>Changer le Mot de Passe</h5>
        </div>
        <div class="card-body">
          <form id="passwordChangeForm">
            <div class="mb-3">
              <label for="currentPassword" class="form-label"
                >Mot de passe actuel</label
              >
              <input
                type="password"
                class="form-control"
                id="currentPassword"
                name="currentPassword"
                required
              />
            </div>
            <div class="mb-3">
              <label for="newPassword" class="form-label"
                >Nouveau mot de passe</label
              >
              <input
                type="password"
                class="form-control"
                id="newPassword"
                name="newPassword"
                required
              />
            </div>
            <div class="mb-3">
              <label for="confirmNewPassword" class="form-label"
                >Confirmer le nouveau mot de passe</label
              >
              <input
                type="password"
                class="form-control"
                id="confirmNewPassword"
                name="confirmNewPassword"
                required
              />
            </div>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-lock me-2"></i>Modifier le mot de passe
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS + FontAwesome -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Back arrow functionality (copied from demande.html)
        const backArrow = document.getElementById("backArrow");
        backArrow.addEventListener("click", function () {
          window.history.back();
        });

        // Profile Image Preview
        const profilePictureInput = document.getElementById(
          "profilePictureInput"
        );
        const profileImagePreview = document.getElementById(
          "profileImagePreview"
        );

        profilePictureInput.addEventListener("change", function (event) {
          if (event.target.files && event.target.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
              profileImagePreview.src = e.target.result;
            };
            reader.readAsDataURL(event.target.files[0]);
          }
        });

        // --- Form Submission Handlers (Add AJAX here) ---

        // Personal Info Form
        document
          .getElementById("personalInfoForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            const form = e.target;
            const formData = new FormData();
            formData.append("action", "personal_info");
            formData.append(
              "firstName",
              document.getElementById("firstName").value
            );
            formData.append(
              "lastName",
              document.getElementById("lastName").value
            );
            formData.append("phone", document.getElementById("phone").value);
            formData.append(
              "address",
              document.getElementById("address").value
            );

            fetch("../handle_profile_update.php", {
              method: "POST",
              body: formData,
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  alert(data.message);
                } else {
                  alert("Erreur: " + data.message);
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert(
                  "Une erreur est survenue lors de la mise à jour des informations personnelles."
                );
              });
          });

        // Profile Picture Form
        document
          .getElementById("profilePictureForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            const form = e.target;
            const formData = new FormData(form);
            formData.append("action", "profile_picture"); // Add action for PHP handler

            fetch("../handle_profile_update.php", {
              method: "POST",
              body: formData,
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  alert(data.message);
                  if (data.profile_picture_path) {
                    document.getElementById("profileImagePreview").src =
                      data.profile_picture_path;
                  }
                } else {
                  alert("Erreur: " + data.message);
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert(
                  "Une erreur est survenue lors du téléchargement de la photo."
                );
              });
          });

        // Password Change Form
        document
          .getElementById("passwordChangeForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            const form = e.target;
            const formData = new FormData();
            formData.append("action", "password_change");
            formData.append(
              "currentPassword",
              document.getElementById("currentPassword").value
            );
            formData.append(
              "newPassword",
              document.getElementById("newPassword").value
            );
            formData.append(
              "confirmNewPassword",
              document.getElementById("confirmNewPassword").value
            );

            fetch("../handle_profile_update.php", {
              method: "POST",
              body: formData,
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  alert(data.message);
                  form.reset(); // Clear password fields on success
                } else {
                  alert("Erreur: " + data.message);
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert(
                  "Une erreur est survenue lors du changement de mot de passe."
                );
              });
          });
      });
    </script>
  </body>
</html>
